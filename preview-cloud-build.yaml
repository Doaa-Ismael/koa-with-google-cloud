steps:
  - name: 'gcr.io/kaniko-project/executor:latest'
    args:
      - --destination=gcr.io/$PROJECT_ID/cloudrun-image:$_PR_NUMBER
      - --cache=true
    timeout: 2700s
  - name: "gcr.io/cloud-builders/gcloud"
    args: ['run', 'deploy', 'cloud-run-default', '--image', "gcr.io/$PROJECT_ID/cloudrun-image:$CI_MERGE_REQUEST_IID", '--region', 'us-east1', '--platform', 'managed', '--allow-unauthenticated', '--memory', '4Gi', '--no-traffic', '--tag', 'pr-$_PR_NUMBER' ]
options:
  logging: CLOUD_LOGGING_ONLY
  machineType: N1_HIGHCPU_8
timeout: 2700s
